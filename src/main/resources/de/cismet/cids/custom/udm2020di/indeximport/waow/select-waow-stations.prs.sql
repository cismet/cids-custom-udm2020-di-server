SELECT MESSSTELLEN.PK, MESSSTELLEN.NAME, /*MESSSTELLEN.TYP,*/ MESSSTELLEN.XKOORDINATE, 
       MESSSTELLEN.YKOORDINATE, ZUSTAENDIGESTELLE, /*BUNDESLAND,*/ GEWAESSER_NAME, 
       /*GEWAESSER_EZK,*/
    XMLSerialize(CONTENT XMLRoot(XMLELEMENT("MESSSTELLE",  
        XMLATTRIBUTES(MESSSTELLEN.PK pk, 
            MESSSTELLEN.NAME name, 
            MESSSTELLEN.TYP typ, 
            MESSSTELLEN.STATUS status, 
            MESSSTELLEN.OPERATIV operativ, 
            MESSSTELLEN.EZGGROESSE ezggroesse, 
            MESSSTELLEN.XKOORDINATE xkoordinate,
            MESSSTELLEN.XKOORDINATE ykoordinate,
            MESSSTELLEN.ZUSTAENDIGESTELLE zustaendigestelle,
            MESSSTELLEN.BUNDESLAND bundesland,
            MESSSTELLEN.GEWAESSER_NAME gewaessername,
            MESSSTELLEN.GEWAESSER_EZK gewaesserezk),
(SELECT XMLELEMENT("proben", xmlagg (xmlelement ("probe", V_WAOW_PROBE_D.PK
    /*XMLATTRIBUTES(V_WAOW_PROBE_D.PK probePk, V_WAOW_PROBE_D.PROBEDATUM_DATE probeDatum)*/))) AS PROBEN 
            FROM V_WAOW_PROBE_D  
            WHERE V_WAOW_PROBE_D.FK_V_WAOW_MST_D_ID = MESSSTELLEN.PK)  AS PROBEN,
(SELECT XMLELEMENT("probenparameter",
    xmlagg (xmlelement ("PROBENPARAMETER", XMLATTRIBUTES(PROBENPARAMETER.PARAMETER_PK parameterPk, 
    /*PROBENPARAMETER.PARAMETERGRUPPE_PK parametergruppePk, PROBENPARAMETER.PARAMETERGRUPPE_NAME parametergruppeName, */
    PROBENPARAMETER.PARAMETER_NAME parameterName)))) AS PROBENPARAMETER
FROM
    (SELECT DISTINCT V_WAOW_MST_D.PK AS MESSTELLE_PK,
        V_WAOW_PARAM_D.PK AS PARAMETER_PK,
        V_WAOW_PARAM_D.NAME_TXT AS PARAMETER_NAME
        --,V_WAOW_PARAMGRUPPE_D.PK AS PARAMETERGRUPPE_PK,
        --V_WAOW_PARAMGRUPPE_D.NAME_TXT PARAMETERGRUPPE_NAME
    FROM V_WAOW_MST_D
    INNER JOIN V_WAOW_PROBE_D ON V_WAOW_PROBE_D.FK_V_WAOW_MST_D_ID = V_WAOW_MST_D.PK
    INNER JOIN V_WAOW_PARAMWERT_F ON V_WAOW_PARAMWERT_F.FK_V_WAOW_PROBE_D_ID = V_WAOW_PROBE_D.PK
    INNER JOIN V_WAOW_PARAM_D ON V_WAOW_PARAMWERT_F.FK_V_WAOW_PARAM_D_ID = V_WAOW_PARAM_D.PK
    INNER JOIN V_WAOW_BRIDGEPARAMGRP_D ON V_WAOW_BRIDGEPARAMGRP_D.FK_V_WAOW_PARAM_D_ID = V_WAOW_PARAM_D.PK
    INNER JOIN V_WAOW_PARAMGRUPPE_D  ON V_WAOW_BRIDGEPARAMGRP_D.FK_V_WAOW_PARAMGRUPPE_D_ID = V_WAOW_PARAMGRUPPE_D.PK
    WHERE V_WAOW_PARAMGRUPPE_D.PK IN('22', 
        '23', 
        '4028f0f02e288f22012e2907d7fd0012', 
        '40287e021d85970d011d86c8b4430073', 
        '40287e021d85970d011d86d2be810088', 
        '8ae5e2f31a15970d011a1597231b0012', 
        '8ae5e2f31c416081011c41608ec50004', 
        '8ae5e2f31c416081011c41608ec50005', 
        '8a20a1ac22a102b80122efd78f4458e1', 
        '8a20a1ac22a102b80122efd8a75a58e2', 
        '8a20a1ac23042e650123048410ee01ec', 
        '8a20a1ac23042e6501230485923e01ed', 
        '8a20a2bf4e1cfe1e014e3f7b7a520003', 
        '8a20a2b93cf249d8013cf7aa2b4224f9', 
        '8a20a2b93cf249d8013cf7a0d67424e5', 
        '8a20a2b93cf249d8013cf80ecb8825c8', 
        '8a20a2b93cf249d8013cf80fe9b625d2', 
        '8a20a2b93cf249d8013cf815ee4525db', 
        '8a20a2b93e82afe5013ec77edd2709eb', 
        '8a20a2b931513a2f0131f4bd0ca7537b', 
        '8a20a2b931513a2f0131f4bf5101538c', 
        '8a20a2b931513a2f0131f4c4bc1e5393', 
        '8a20a2b93214a76801328187f15576c6')
        AND V_WAOW_PARAMWERT_F.WERT_NUM IS NOT NULL
    GROUP BY V_WAOW_MST_D.PK, V_WAOW_PARAM_D.PK, V_WAOW_PARAM_D.NAME_TXT
    --,V_WAOW_PARAMGRUPPE_D.PK, V_WAOW_PARAMGRUPPE_D.NAME_TXT
    ORDER BY MESSTELLE_PK, PARAMETER_PK) PROBENPARAMETER
WHERE PROBENPARAMETER.MESSTELLE_PK = MESSSTELLEN.PK
GROUP BY PROBENPARAMETER.MESSTELLE_PK) AS PROBENPARAMETER), VERSION '1.0' , STANDALONE YES))  AS MESSSTELLE_XML
FROM (
    SELECT DISTINCT MESSSTELLE.PK AS PK,
    MESSSTELLE.NAME_TXT AS NAME,
    MESSSTELLE.TYPE_TXT AS TYP,
    MESSSTELLE.STATUS_TXT AS STATUS, 
    MESSSTELLE.OPERATIVEMESSSTELLE_TXT AS OPERATIV, 
    MESSSTELLE.EZGGROESSE_NUM AS EZGGROESSE,
    MESSSTELLE.XKOORDINATE_NUM AS XKOORDINATE,
    MESSSTELLE.YKOORDINATE_NUM AS YKOORDINATE,
    --PARAMETER.*,
    --MESSSTELLE.*,
    --V_WA_PLANUNGSRAUM_D.*, 
    --V_WA_GEWAESSER_HD.*,
    MAX(ZUSTAENDIGESTELLE.NAME_TXT) AS ZUSTAENDIGESTELLE, 
    -- BIOREGION.*,
    MAX(PROVINCE.NAME_TXT) AS BUNDESLAND,
    MAX(GEWAESSER.NAME_TXT) AS GEWAESSER_NAME,
    MAX(GEWAESSER.EZK_TXT) AS GEWAESSER_EZK
    FROM V_WAOW_MST_D MESSSTELLE
    --INNER JOIN V_WA_PLANUNGSRAUM_D ON V_WA_PLANUNGSRAUM_D.PK = MESSSTELLE.FK_V_WA_PLANUNGSRAUM_D_ID
    --INNER JOIN V_WA_GEWAESSER_HD ON V_WA_GEWAESSER_HD.PK = MESSSTELLE.FK_V_WA_GEWAESSER_D_ID
    INNER JOIN V_WA_ZUSTAENDIGESTELLE_D ZUSTAENDIGESTELLE ON ZUSTAENDIGESTELLE.PK = MESSSTELLE.FK_V_WA_ZUSTAENDIGESTELLE_D_ID
    --INNER JOIN V_WA_BIOREGION_D BIOREGION ON BIOREGION.PK = MESSSTELLE.FK_V_WA_BIOREGION_D_ID  
    INNER JOIN V_PROVINCE_HD PROVINCE ON PROVINCE.PK = MESSSTELLE.FK_V_PROVINCE_HD_ID 
    INNER JOIN V_WA_GEWAESSER_HD GEWAESSER ON MESSSTELLE.FK_V_WA_GEWAESSER_D_ID = GEWAESSER.PK
    INNER JOIN V_WAOW_PROBE_D PROBE ON PROBE.FK_V_WAOW_MST_D_ID = MESSSTELLE.PK
    INNER JOIN V_WAOW_PARAMWERT_F PARAMWERT ON PARAMWERT.FK_V_WAOW_PROBE_D_ID = PROBE.PK
    INNER JOIN V_WAOW_PARAM_D PARAMETER ON PARAMWERT.FK_V_WAOW_PARAM_D_ID = PARAMETER.PK
    INNER JOIN V_WAOW_BRIDGEPARAMGRP_D BRIDGEPARAMGRP ON BRIDGEPARAMGRP.FK_V_WAOW_PARAM_D_ID = PARAMETER.PK
    INNER JOIN V_WAGW_PARAMGRUPPE_D PARAMETERGRUPPE ON BRIDGEPARAMGRP.FK_V_WAOW_PARAMGRUPPE_D_ID = PARAMETERGRUPPE.PK
    WHERE SDO_GEOM.RELATE(
        sdo_geometry('Polygon ((541379 523462, 541379 423907, 657834 423907, 657834 523462, 541379 523462))',31287),
        'contains', MESSSTELLE.MST_GPT, 0.10) = 'CONTAINS'
    AND PARAMETERGRUPPE.PK IN('22', 
        '23', 
        '4028f0f02e288f22012e2907d7fd0012', 
        '40287e021d85970d011d86c8b4430073', 
        '40287e021d85970d011d86d2be810088', 
        '8ae5e2f31a15970d011a1597231b0012', 
        '8ae5e2f31c416081011c41608ec50004', 
        '8ae5e2f31c416081011c41608ec50005', 
        '8a20a1ac22a102b80122efd78f4458e1', 
        '8a20a1ac22a102b80122efd8a75a58e2', 
        '8a20a1ac23042e650123048410ee01ec', 
        '8a20a1ac23042e6501230485923e01ed', 
        '8a20a2bf4e1cfe1e014e3f7b7a520003', 
        '8a20a2b93cf249d8013cf7aa2b4224f9', 
        '8a20a2b93cf249d8013cf7a0d67424e5', 
        '8a20a2b93cf249d8013cf80ecb8825c8', 
        '8a20a2b93cf249d8013cf80fe9b625d2', 
        '8a20a2b93cf249d8013cf815ee4525db', 
        '8a20a2b93e82afe5013ec77edd2709eb', 
        '8a20a2b931513a2f0131f4bd0ca7537b', 
        '8a20a2b931513a2f0131f4bf5101538c', 
        '8a20a2b931513a2f0131f4c4bc1e5393', 
        '8a20a2b93214a76801328187f15576c6')
    AND ROWNUM < 10
    GROUP BY MESSSTELLE.PK, MESSSTELLE.NAME_TXT, MESSSTELLE.TYPE_TXT,
        MESSSTELLE.STATUS_TXT, MESSSTELLE.OPERATIVEMESSSTELLE_TXT, MESSSTELLE.EZGGROESSE_NUM,
        MESSSTELLE.XKOORDINATE_NUM , MESSSTELLE.YKOORDINATE_NUM
    ORDER BY MESSSTELLE.PK) MESSSTELLEN